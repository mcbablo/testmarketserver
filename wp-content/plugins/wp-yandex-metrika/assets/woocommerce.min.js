jQuery(function(u){if(u(document.body).trigger("wpym_ec_ready"),wpym.ec.isDetail()){wpym.ec.hasActiveVariation()||wpym.ec.send("detail",wpym.ec.getDetailProductId());let a=[];u(document.body).on("found_variation",function(t,e){-1===a.indexOf(e.variation_id)&&(wpym.ec.send("detail",wpym.ec.getDetailProductId(),{variant:m(e),price:e.display_price}),a.push(e.variation_id))})}function s(t,e,a){e=e||function(t){};let n=a||null;return t.length&&t.each(function(){var t=u(this).val();if(e(t))return n=t,!1}),n}function m(e){if(!e.attributes)return console.log('Variation "'+e.variation_id+'" has no attributes.'),"";let a=[];return Object.keys(e.attributes).sort().forEach(function(t){a.push(e.attributes[t])}),a.join(", ")}u(document.body).on("updated_cart_totals wc_cart_emptied",function(t){const e=u('input[name^="cart["][name$="[qty]"]'),n={};e.each(function(){const t=u(this),e=t.attr("name").match(/^cart\[([^\]]+)\]/)[1],a=t.val();n[e]={quantity:parseInt(a)}}),wpym.ec.updateCartItems(n)}),u(document.body).on("added_to_cart",function(t,e,a,n){var o=n.closest("form");let i=n.data("product_id")?n.data("product_id"):0,r=n.data("variation_id")?n.data("variation_id"):0,c=n.data("quantity")?n.data("quantity"):1;o.length&&(c=s(u('[name="quantity"], input.qty',o),function(t){return 0<t},c),i=s(u('[name="product_id"], [name="add-to-cart"]',o),function(t){return 0<t},i),r=s(u('[name="variation_id"]',o),function(t){return 0<t},r));let d={quantity:c};if(r){let t=!1;o=function(e,t){const a=t.data("product_variations");t=!1;a||console.log('Form has no variations in "data-product_variations" attribute.');(t=a.find(function(t){return t.variation_id==e}))||console.log('Variation "'+e+'" not found in form variations.');return t}(r,o);o&&(t=m(o)),t&&(d.variant=t)}i?(u.ajax({url:wpym.ajaxurl,data:{action:"yam_get_cart_items"},dataType:"json",success:function(t){wpym.ec.clearCartItems(),wpym.ec.addData(t)}}),wpym.ec.send("add",i,d)):console.log("ProductId not found.")}),u(document.body).on("removed_from_cart",function(t,e,a,n){let o=n.data("cart_item_key"),i=1;const r=n.attr("href");var c;o||!r||(c=r.match(/(\?|&)remove_item=([^&#]+)/))&&c[2]&&(o=c[2]),o?(void 0!==(c=wpym.ec.getCartItems())[o]&&(i=c[o].quantity),wpym.ec.send("remove",o,{quantity:i})):console.log("Cart item key not found.")}),u(".woocommerce-checkout").on("checkout_place_order_success",function(t,e){if(!e||!e.order_id)return console.log("Failed to get an order ID to send a purchase event"),!0;const a=e.redirect;let n="";var o=a.match(/(\?|&)key=(.*?)(&|$)/);o&&o[2]&&(n=o[2]),e.redirect="#order-processing",u.ajax({url:wpym.ajaxurl,data:{action:"yam_get_purchase",order_id:e.order_id,order_key:n},dataType:"json",success:function(t){t?t.isSent?console.log("Order #"+e.order_id+" already sent."):t.products&&t.actionField&&wpym.ec.sendPurchase(t.actionField,t.products):console.log("Order #"+e.order_id+" not found."),setTimeout(function(){-1===a.indexOf("https://")||-1===a.indexOf("http://")?window.location=a:window.location=decodeURI(a)},100)}})})});