class KallesMapWidgetHandle extends elementorModules.frontend.handlers.Base{getDefaultSettings(){return{selectors:{container:".kalles-map"}}}getDefaultElements(){const e=this.getSettings("selectors");return{$container:this.$element.find(e.container)}}kallesMapBox(){var e=this,t=[],n=e.elements.$container,s=n.data("locations"),a=s.localtions,o=s.token,l=mapboxSdk({accessToken:o}),r=n.find(".kalles-map__content").attr("id");return mapboxgl.accessToken=o,jQuery.each(a,function(a,i){l.geocoding.forwardGeocode({query:i,autocomplete:!1,limit:1}).send().then(function(l){if(l&&l.body&&l.body.features&&l.body.features.length){var d=l.body.features[0],c=n.find(".kalles-map__list .kalles-map__list--item");c.eq(a).attr("data-latitude",d.center[0]),c.eq(a).attr("data-longitude",d.center[1]);var m={type:"Feature",properties:{description:c.eq(a).html(),icon:"theatre"},geometry:{type:"Point",coordinates:[d.center[0],d.center[1]]}};if(0==a){var u=[d.center[0],d.center[1]],p=i;e.load_map(r,s,c,o,t,u,p)}t.push(m),a++}})}),t}load_map(e,t,n,s,a,o,l){var r=new mapboxgl.Map({container:e,style:"mapbox://styles/mapbox/"+t.style,center:o,zoom:t.zom}),i=new MapboxGeocoder({accessToken:mapboxgl.accessToken});r.addControl(i),r.on("load",function(){!function(e,t){const n=document.getElementsByClassName("mapboxgl-popup");n[0]&&n[0].remove();new mapboxgl.Popup({closeOnClick:!1}).setLngLat(e).setHTML(`<h3>${t}</h3>`).addTo(r)}(o,l)}),n.on("click",function(){var e=jQuery(this).data("latitude"),n=jQuery(this).data("longitude");r.flyTo({center:[e,n],zoom:t.zom,essential:!0,speed:3,curve:1})})}onInit(){super.onInit(),this.kallesMapBox()}}class KallesNewsletterFormWidgetHandle extends elementorModules.frontend.handlers.Base{getDefaultSettings(){return{selectors:{container:".newsletter_se"}}}getDefaultElements(){const e=this.getSettings("selectors");return{$container:this.$element.find(e.container)}}handleKlaviyo(){const e=this.elements.$container.find(".klaviyo_sub_frm");if(e){var t=e.attr("brand")||"Kalles Klaviyo";KlaviyoSubscribe.attachToForms(e,{custom_success_message:!0,extra_properties:{$source:"NewsletterPopup",Brand:t},success:function(t){e.find('[type="submit"]').removeClass("loading")}}),e.submit(function(t){e.find('[type="submit"]').addClass("loading")}),jQuery("body").on("klaviyo.subscribe.success klaviyo.subscribe.error",function(e){jQuery(e.target).find('[type="submit"]').removeClass("loading")})}}handleMailchimp(){jQuery(".nt_ajax_mcsp").submit(function(e){e.preventDefault();var t=jQuery(this).closest("form"),n=t.find(".mc4wp-response"),s=t.find('[type="submit"]');s.addClass("loading"),jQuery.ajax({type:"GET",url:t.attr("action"),data:t.serialize(),cache:!1,dataType:"jsonp",jsonp:"c",contentType:"application/json; charset=utf-8",success:function(e){s.removeClass("loading"),"success"==e.result?(n.find(".success_message").html(e.messenger),n.find(".success_message").slideDown(100)):(n.find(".error_message").html(e.msg),n.find(".error_message").slideDown(100))}})})}onInit(){super.onInit();const e=this.elements.$container.attr("data-platform");"mailchimp"==e?this.handleMailchimp():"klaviyo"==e&&this.handleKlaviyo()}}jQuery(window).on("elementor/frontend/init",()=>{elementorFrontend.hooks.addAction("frontend/element_ready/kalles-map.default",e=>{elementorFrontend.elementsHandler.addHandler(KallesMapWidgetHandle,{$element:e})}),elementorFrontend.hooks.addAction("frontend/element_ready/kalles-newsletter-form.default",e=>{elementorFrontend.elementsHandler.addHandler(KallesNewsletterFormWidgetHandle,{$element:e})})});